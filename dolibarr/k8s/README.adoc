= Dolibarr on Kubernetes
:author:    Antonio C.
:email:     <ac (at) trikorasolutions (dot) com>
:revdate:   {{docdate}}
:toc:       left
:toc-title: Table of Contents
:icons:     font
:description: Dolibarr on a Kubernetes cluster.
:source-highlighter: highlight.js

== Introduction

[.lead]
Dolibarr on a Kubernetes cluster.

This document describes ths Dolibarr deployment and maintenance tasks on a 
 Kubernetes cluster.



== Installation Guide

=== Namespace

[.lead]
Create the namespace.

[source,bash]
----
ansible-playbook kubernetes/ansible/create-namespace-playbook.yaml \
  -e @dolibarr/k8s/helm/ansible/defaults/main.yaml
----

=== PostgreSQL

[.lead]
Install PostgreSQL using the Helm Chart.

[source,bash]
----
ansible-playbook pgsql/k8s/helm/ansible/pgsql-install-playbook.yaml \
  -e "@kubernetes/storage/ceph/ansible/defaults/main.yaml" \
  -e @dolibarr/k8s/helm/ansible/defaults/main.yaml \
  -e db_password=${DB_PASSWORD}
----

=== Dolibarr

[.lead]
Deploy the Dolibarr container.

Set the environment variables.

[source,bash]
----
DB_PASSWORD=
APP_ADMIN_PASSWORD=
CRON_KEY=
ROOT_URL=
----


== Uninstall

[NOTE]
====
Optionally set the trikora_helm_project_dir variable if deploying local helm chart project.

[source,bash]
----
ansible-playbook dolibarr/k8s/helm/ansible/dolibarr-install-pb.yaml \
  -e "@_local_config/network.yaml" \
  -e "@kubernetes/storage/ceph/ansible/defaults/main.yaml" \
  -e @dolibarr/k8s/helm/ansible/defaults/main.yaml \
  -e db_assword="${DB_PASSWORD}" \
  -e app_admin_password="${APP_ADMIN_PASSWORD}" \
  -e cron_key="${CRON_KEY}" \
  -e root_url="${ROOT_URL}" \
  -e trikora_helm_project_dir=....
----


PostgreSQL

[source,bash]
----
ansible-playbook pgsql/k8s/helm/ansible/pgsql-uninstall-playbook.yaml \
  -e @dolibarr/k8s/helm/ansible/defaults/main.yaml
----