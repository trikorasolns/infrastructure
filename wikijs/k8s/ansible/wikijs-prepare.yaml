---
- name: "Prepare for Wiki.js install"
  hosts: localhost
  gather_facts: "{{ gathering_host_info | default('true') | bool == true }}"

  # pre_tasks:
  #   - name: "Set PV_ROOT_FOLDER from kubernetes host if not set"
  #     set_fact:
  #       pv_root_folder: 
  #     when: pv_root_folder is undefined and k8s is defined and k8s.pv_root_folder is defined
      
  tasks:

    - name: "Create Wiki.js k8s namespace"
      kubernetes.core.k8s:
        name: "{{ app_namespace }}"
        api_version: v1
        kind: Namespace
        state: present

    # Patch existing namespace : add label
    - name: "Add labels to Wiki.js namespace"
      kubernetes.core.k8s:
        state: patched
        kind: Namespace
        name: "{{ app_namespace }}"
        definition:
          metadata:
            labels:
              app.kubernetes.io/name: "{{ app_name }}"
              app.kubernetes.io/version: "{{ app_version }}"

...
