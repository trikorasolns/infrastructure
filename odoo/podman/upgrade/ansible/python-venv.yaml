- name: "Create a Python venv for the required Python version."
  hosts: "localhost"
  gather_facts: false
  vars:
    to_python_version: 3.10
    temporary_folder: /z/_tmp

  pre_tasks:
    - name: "Check variables"
      ansible.builtin.assert:
        that:
          # - "k8s_config_file is defined"
          - "from_version is defined"
          - "to_version is defined"

    - name: "Set variables"
      ansible.builtin.set_fact:
        odoo_old_pod_name: "{{ odoo_old_pod_name_prefix }}{{ from_version }}"

  tasks:

    - name: "Cleanup any existing upgrade installation."
      ansible.builtin.shell: |
        python{{ to_python_version }} -m venv {{ temporary_folder }}/venv_python_{{ to_python_version }}
    
    - name: "Cleanup any existing upgrade installation."
      ansible.builtin.shell: |
        source {{ temporary_folder }}/venv_python_{{ to_python_version }}/bin/activate
        python -m ensurepip --upgrade
        python -m pip install git+https://github.com/OCA/openupgradelib.git@3.11.1#egg=openupgradelib
        python -m pip freeze | grep openupgradelib > requirements.txt
        mkdir pip-reqs
        python -m pip download -r requirements.txt -d pip-reqs/
        deactivate
...
