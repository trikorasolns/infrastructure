---
- import_playbook: playbook-init.yaml

- name: "Prepare Odoo for kubernetes installation"
  hosts: "{{ k8s_host }}"
  gather_facts: "{{ gathering_host_info | default('true') | bool == true }}"

  tasks:

    - name: "Create sub-folders for odoo PV"
      file:
        path: "{{ k8s.pv_root_folder }}/{{ app_name }}/{{ gitlab_pod_folders }}"
        state: directory
        mode: 0755
        owner: "101"
        group: "101"
      become: true
      loop:
        - "odoo_web_addons"
        - "odoo_web_configs"
        - "odoo_web_data"
      loop_control:
        loop_var: gitlab_pod_folders 

    - name: "Odoo: Template PV file"
      ansible.builtin.template:
        src: "odoo-pv-hostpath.yaml.j2"
        dest: "/tmp/odoo-pv-hostPath.yaml"

    - name: "Odoo: Apply PV file"
      kubernetes.core.k8s:
        state: absent
        src: "/tmp/odoo-pv-hostPath.yaml"

    - name: "Odoo: Apply PV file"
      kubernetes.core.k8s:
        state: present
        src: "/tmp/odoo-pv-hostPath.yaml"
...
