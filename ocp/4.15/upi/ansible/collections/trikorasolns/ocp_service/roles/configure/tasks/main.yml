#SPDX-License-Identifier: MIT-0
---
- name: "Set variables"
  ansible.builtin.set_fact:
    openshift_client_root_url: "https://mirror.openshift.com/pub/openshift-v4/{{ ocp_release_arch }}/clients/ocp/{{ ocp_version }}"

- name: "Create openshift install root directory"
  ansible.builtin.file:
    path: "{{ configure_install_root_dir }}"
    state: directory
    mode: '0755'

- name: "Get release information"
  ansible.builtin.get_url:
    url: "{{ openshift_client_root_url }}/release.txt"
    dest: "{{ configure_install_root_dir }}/"

- name: "Get release image name"
  ansible.builtin.shell: |
    grep 'Pull From: quay.io' release.txt | awk -F ' ' '{print $3}'
  args:
    chdir: "{{ configure_install_root_dir }}"
  register: image_name_res

- name: "Print image name"
  ansible.builtin.debug:
    msg:
      - "image_name_res: {{ image_name_res.stdout }}"

- name: "Download the ocp installer and client"
  ansible.builtin.get_url:
    url: "{{ openshift_client_root_url }}/{{ item }}"
    dest: "{{ configure_install_root_dir }}/{{ item }}"
  loop:
    - openshift-install-linux.tar.gz
    - openshift-client-linux.tar.gz
  when: skip_download is undefined or not (skip_download | bool)

- name: "Extract the ocp installer and client"
  ansible.builtin.unarchive:
    src: "{{ configure_install_root_dir }}/{{ item }}"
    dest: "{{ configure_install_root_dir }}"
    remote_src: true
  loop:
    - openshift-install-linux.tar.gz
    - openshift-client-linux.tar.gz
  when: skip_download is undefined or not (skip_download | bool)

- name: "Print image name"
  ansible.builtin.debug:
    msg:
      - "Installation folder: {{ configure_install_root_dir }}/"
      - "image_name_res: {{ image_name_res.stdout }}"

...
